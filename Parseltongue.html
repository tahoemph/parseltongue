<html><head><title>Parseltongue</title><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol{margin:0;padding:0}.c0{widows:2;orphans:2;direction:ltr}.c8{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c7{color:inherit;text-decoration:inherit}.c3{color:#1155cc;text-decoration:underline}.c1{page-break-after:avoid}.c6{margin-left:36pt}.c4{font-family:"Courier New"}.c2{height:11pt}.c5{margin-left:18pt}.title{widows:2;padding-top:0pt;line-height:1.15;orphans:2;text-align:left;color:#000000;font-size:21pt;font-family:"Trebuchet MS";padding-bottom:0pt;page-break-after:avoid}.subtitle{widows:2;padding-top:0pt;line-height:1.15;orphans:2;text-align:left;color:#666666;font-style:italic;font-size:13pt;font-family:"Trebuchet MS";padding-bottom:10pt;page-break-after:avoid}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{widows:2;padding-top:10pt;line-height:1.15;orphans:2;text-align:left;color:#000000;font-size:16pt;font-family:"Trebuchet MS";padding-bottom:0pt;page-break-after:avoid}h2{widows:2;padding-top:10pt;line-height:1.15;orphans:2;text-align:left;color:#000000;font-size:13pt;font-family:"Trebuchet MS";font-weight:bold;padding-bottom:0pt;page-break-after:avoid}h3{widows:2;padding-top:8pt;line-height:1.15;orphans:2;text-align:left;color:#666666;font-size:12pt;font-family:"Trebuchet MS";font-weight:bold;padding-bottom:0pt;page-break-after:avoid}h4{widows:2;padding-top:8pt;line-height:1.15;orphans:2;text-align:left;color:#666666;font-size:11pt;text-decoration:underline;font-family:"Trebuchet MS";padding-bottom:0pt;page-break-after:avoid}h5{widows:2;padding-top:8pt;line-height:1.15;orphans:2;text-align:left;color:#666666;font-size:11pt;font-family:"Trebuchet MS";padding-bottom:0pt;page-break-after:avoid}h6{widows:2;padding-top:8pt;line-height:1.15;orphans:2;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Trebuchet MS";padding-bottom:0pt;page-break-after:avoid}</style></head><body class="c8"><p class="c0 c1 title"><a name="h.g894xzwcy07a"></a><span>So you wanna speak Parseltongue?</span></p><p class="c0 c5"><span class="c3"><a class="c7" href="#h.3ansocxiwo9">Introduction</a></span></p><p class="c0 c5"><span class="c3"><a class="c7" href="#h.jodnkjx9tm7b">History</a></span></p><p class="c0 c5"><span class="c3"><a class="c7" href="#h.kq87nccmuibo">Categorization</a></span></p><p class="c0 c5"><span class="c3"><a class="c7" href="#h.ntzqrf5bvmsx">Stylistic structure</a></span></p><p class="c0 c5"><span class="c3"><a class="c7" href="#h.jpv29t9aa3a8">Interesting Features</a></span></p><p class="c0 c6"><span class="c3"><a class="c7" href="#h.vtsupzq2n90q">List Comprehensions</a></span></p><p class="c0 c6"><span class="c3"><a class="c7" href="#h.vxmuxbhdgycd">Generators</a></span></p><p class="c0 c6"><span class="c3"><a class="c7" href="#h.nehfezpoa7wr">Object Oriented Features</a></span></p><p class="c0 c6"><span class="c3"><a class="c7" href="#h.ny9fqpb2kkvw">Functional Features</a></span></p><p class="c0 c6"><span class="c3"><a class="c7" href="#h.id8nhs8wk8ip">Meta Programming</a></span></p><p class="c0 c5"><span class="c3"><a class="c7" href="#h.55mc19riilwj">Performance considerations</a></span></p><p class="c0 c5"><span class="c3"><a class="c7" href="#h.19qm3vpgquvi">Test Frameworks</a></span></p><p class="c0 c5"><span class="c3"><a class="c7" href="#h.o5znyaqol7cr">Logging</a></span></p><p class="c0 c5"><span class="c3"><a class="c7" href="#h.honc2v4c1vj6">GIL</a></span></p><p class="c0 c5"><span class="c3"><a class="c7" href="#h.jn7qh7kh8apj">Other Resources</a></span></p><h1 class="c0 c1"><a name="h.3ansocxiwo9"></a><span>Introduction</span></h1><p class="c0"><span>We all learned a first real language. &nbsp;For me I started with BASIC on a Vic 20 in 1981 or so. &nbsp;Later Forth and 6502. &nbsp;But the first real language was c. &nbsp;It still is the mother tongue. &nbsp;It is the best for highly performant software and is contains the most reused libraries. &nbsp;But for many tasks there are languages that are better suited from a software engineering standpoint. &nbsp;In this document I&rsquo;ll describe steps you can take to learn to write in Python without too much of an accent. &nbsp;By learning how to write Python in a relatively native manner you make it easier for others to read your code, make it more likely you will use constructs that perform well, and will make it easier on yourself when you need to read others code.</span></p><p class="c0 c2"><span></span></p><p class="c0"><span>This document will assume you have read a basic tutorial but are now trying to fit the pieces together.</span></p><h1 class="c0 c1"><a name="h.jodnkjx9tm7b"></a><span>History</span></h1><p class="c0"><span>Python was conceived and originally developed by Guido Van Rossum as a replacement for the teaching language ABC starting in the late 80s. &nbsp;From the standpoint of writing modern Python the interesting part of the history begins in 2008 when Python 3 is released. &nbsp;Since then the Python 2.x line is capped at 2.7. &nbsp;Until fairly recently most of the major Python libraries have not been available in Python 3.</span></p><p class="c0 c2"><span></span></p><p class="c0"><span>Python is managed by the Python Foundation. &nbsp;There are a series of proposals for extending the language and the libraries called PEPs.</span></p><h1 class="c0 c1"><a name="h.kq87nccmuibo"></a><span>Categorization</span></h1><p class="c0"><span>Python is a multi-paradigm language. &nbsp;Its basic control flow structures are like those of other Algol based languages. &nbsp;Its module and object oriented structures are adapted from modula. &nbsp;And it has many functional features taken from haskell and other languages.</span></p><h1 class="c0 c1"><a name="h.ntzqrf5bvmsx"></a><span>Stylistic structure</span></h1><p class="c0"><span>Guido set the pace for stylistic structure fairly early. &nbsp;PEP 8 lays out what good source should look like. &nbsp;Unlike many early languages this is fairly well followed. &nbsp;Some parts of the standard library were developed in various styles, but in general the PEP 8 style pervades the community.</span></p><p class="c0 c2"><span></span></p><p class="c0"><span>There is a general zen of python that you can read by typing &ldquo;import this&rdquo; at a python REPL prompt. &nbsp;Fundamentally it encourages you to stick to things that are easy to read and simple to comprehend.</span></p><h1 class="c0 c1"><a name="h.jpv29t9aa3a8"></a><span>Interesting Features</span></h1><h2 class="c0 c1"><a name="h.vtsupzq2n90q"></a><span>List Comprehensions</span></h2><p class="c0"><span>This is a concept taken from functional languages. &nbsp;As noted later one of the best way to get good performance from python is to spend as much time in code written in c as possible. &nbsp;So when building a data structure expressing that in a comprehension will produce the best performance by far.</span></p><p class="c0 c2"><span></span></p><p class="c0"><span>So don&rsquo;t do:</span></p><p class="c0"><span class="c4">values = []</span></p><p class="c0"><span class="c4">for i in range(10):</span></p><p class="c0"><span class="c4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;values.append(i**2)</span></p><p class="c0 c2"><span></span></p><p class="c0"><span>Instead do:</span></p><p class="c0"><span class="c4">values = [i**2 for i in range(10)]</span></p><h2 class="c0 c1"><a name="h.vxmuxbhdgycd"></a><span>Generators</span></h2><p class="c0"><span>Initially generators just look like a cute way to hide iteration over a data structure. &nbsp;But more fundamentally they provide a performant way to build pipelines of data. &nbsp;When I was first learning python I was building a ETL system for financial data. &nbsp;One (well, many) of the vendors regularly provided what should have been data in a CSV format but it contained an extra quotation mark if the last entry was a string.</span></p><p class="c0 c2"><span></span></p><p class="c0"><span>So something like:</span></p><p class="c0 c2"><span></span></p><p class="c0"><span class="c4">&ldquo;company 1&rdquo;, &ldquo;address&rdquo;, &ldquo;05112014&rdquo;, 500.0, &ldquo;barf&rdquo;&rdquo;</span></p><p class="c0 c2"><span></span></p><p class="c0"><span>It would have been easy to just fix this with a script that passed over the data generating a valid file but it sucks to start running over the data twice. &nbsp;So instead it is easy to build a generator to fix this problem. &nbsp;Like:</span></p><p class="c0 c2"><span></span></p><p class="c0"><span class="c4">def fix_busted_data(source):</span></p><p class="c0"><span class="c4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for line in source:</span></p><p class="c0"><span class="c4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yield line[:-1] &nbsp;# simplification</span></p><p class="c0 c2"><span></span></p><p class="c0"><span>Now it was easy to do something like:</span></p><p class="c0 c2"><span></span></p><p class="c0"><span class="c4">with open(&ldquo;sourcedata.csv&rdquo;, &ldquo;r&rdquo;) as f:</span></p><p class="c0"><span class="c4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for line in fix_bused_data(f):</span></p><p class="c0"><span class="c4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;process_line(line)</span></p><p class="c0 c2"><span></span></p><p class="c0"><span>You can build much deeper hierarchies of generators pulling data through a series of filters. &nbsp;Note that generators in the c version of python are on the stack of the caller and are much faster than a normal function call.</span></p><p class="c0 c2"><span></span></p><p class="c0"><span>David Beazley has presented on generators (and a related concept coroutines) a fair number of times including a recent python meetup in SF. &nbsp;His talks at </span><span class="c3"><a class="c7" href="http://www.google.com/url?q=http%3A%2F%2Fwww.dabeaz.com%2Fgenerators%2F&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHgQSwBOSX7OQcp3SSqls_7gn5JwQ">http://www.dabeaz.com/generators/</a></span><span>&nbsp;are worthwhile to work your way through.</span></p><h2 class="c0 c1"><a name="h.nehfezpoa7wr"></a><span>Object Oriented Features</span></h2><p class="c0"><span>Python provides a normal set of OO features. &nbsp;The multiple inheritance features are simplified to some extent and in the code I usually see rarely used. &nbsp;Since python 2 the type system is unified such that even the builtin types act in a normal fashion.</span></p><h2 class="c0 c1"><a name="h.ny9fqpb2kkvw"></a><span>Functional Features</span></h2><p class="c0"><span>Over time many functional features have been added to python. &nbsp;In addition to the list comprehensions above these include first class functions. &nbsp;You often see this feature used when metaprogramming with decorators.</span></p><h2 class="c0 c1"><a name="h.id8nhs8wk8ip"></a><span>Meta Programming</span></h2><h1 class="c0 c1"><a name="h.55mc19riilwj"></a><span>Performance considerations</span></h1><p class="c0"><span>Stay off the grass. &nbsp;I mean the interpreter. &nbsp;If you can express something in a way that </span></p><h1 class="c0 c1"><a name="h.19qm3vpgquvi"></a><span>Test Frameworks</span></h1><h1 class="c0 c1"><a name="h.o5znyaqol7cr"></a><span>Logging</span></h1><h1 class="c0 c1"><a name="h.honc2v4c1vj6"></a><span>GIL</span></h1><p class="c0"><span>GIL stands for &ldquo;Global Interpreter Lock&rdquo;. &nbsp;When in the interpreter python takes a big lock. &nbsp;That makes it single threaded. &nbsp;This means that it is hard to achieve parallelism using core python features. &nbsp;So you achieve parallelism by starting up other processes.</span></p><p class="c0 c2"><span></span></p><p class="c0"><span>Concurrency on the other hand can be easily achieved in python.</span></p><h1 class="c0 c1"><a name="h.bxapkqg5bots"></a><span>Development Environments</span></h1><p class="c0"><span>Python is a scripting languages. &nbsp;A core piece of your development environment is the REPL. &nbsp;When you run across something you are uncertain about you should start here. &nbsp;Any good development environment will start here.</span></p><p class="c0 c2"><span></span></p><p class="c0"><span>There is a debugger in the core of Python. &nbsp;Two thing that are useful are the ability to embed breakpoints into code and the ability to run your code under the debugger from its initialization. &nbsp;These look like:</span></p><p class="c0 c2"><span></span></p><p class="c0"><span class="c4">if possible_complex_scenario(inputs):</span></p><p class="c0"><span class="c4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import pdb; pdb.set_trace()</span></p><p class="c0 c2"><span></span></p><p class="c0"><span>When you hit this condition this will stop you at this point and drop you into the debugger.</span></p><p class="c0 c2"><span></span></p><p class="c0"><span class="c4">(env)[mph@li575-52 nesoi]$ python -m pdb nesoi.py &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c0"><span class="c4">&gt; /opt/nesoi-work/nesoi/nesoi.py(1)&lt;module&gt;()</span></p><p class="c0"><span class="c4">-&gt; import argparse</span></p><p class="c0"><span class="c4">(Pdb) b 76</span></p><p class="c0"><span class="c4">Breakpoint 1 at /opt/nesoi-work/nesoi/nesoi.py:76</span></p><p class="c0"><span class="c4">(Pdb) b report</span></p><p class="c0"><span class="c4">Breakpoint 2 at /opt/nesoi-work/nesoi/nesoi.py:151</span></p><p class="c0"><span class="c4">(Pdb) c</span></p><p class="c0"><span class="c4">Traceback (most recent call last):</span></p><p class="c0"><span class="c4">&nbsp; File &quot;/usr/local/lib/python2.7/pdb.py&quot;, line 1314, in main</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; pdb._runscript(mainpyfile)</span></p><p class="c0"><span class="c4">&nbsp; File &quot;/usr/local/lib/python2.7/pdb.py&quot;, line 1233, in _runscript</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; self.run(statement)</span></p><p class="c0"><span class="c4">&nbsp; File &quot;/usr/local/lib/python2.7/bdb.py&quot;, line 400, in run</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; exec cmd in globals, locals</span></p><p class="c0"><span class="c4">&nbsp; File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;</span></p><p class="c0"><span class="c4">&nbsp; File &quot;nesoi.py&quot;, line 13, in &lt;module&gt;</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; something_that_fails</span></p><p class="c0"><span class="c4">NameError: name &#39;something_that_fails&#39; is not defined</span></p><p class="c0"><span class="c4">Uncaught exception. Entering post mortem debugging</span></p><p class="c0"><span class="c4">Running &#39;cont&#39; or &#39;step&#39; will restart the program</span></p><p class="c0"><span class="c4">&gt; /opt/nesoi-work/nesoi/nesoi.py(13)&lt;module&gt;()</span></p><p class="c0"><span class="c4">-&gt; something_that_fails</span></p><p class="c0"><span class="c4">(Pdb) c</span></p><p class="c0"><span class="c4">Post mortem debugger finished. The nesoi.py will be restarted</span></p><p class="c0"><span class="c4">&gt; /opt/nesoi-work/nesoi/nesoi.py(1)&lt;module&gt;()</span></p><p class="c0"><span class="c4">-&gt; import argparse</span></p><p class="c0"><span class="c4">(Pdb) </span></p><p class="c0 c2"><span class="c4"></span></p><p class="c0"><span>There are several things being demonstrated here. &nbsp;The first is how to start up a script with a module loaded and initialized. &nbsp;In this case it is the debugger package and you are stopped at the first line. &nbsp;Next you can set breakpoints. &nbsp;Last if you hit an exception you are stopped, given a stack trace, and able to look around before restarting. &nbsp;This provides for a powerful and tight debug loop.</span></p><p class="c0 c2"><span></span></p><p class="c0"><span>I use vim with a couple of extensions. &nbsp;Chief among these are scrooloose/syntastic and klen/python-mode. &nbsp;This, coupled with tmux, makes for a very good environment for programmers who work on the home row.</span></p><p class="c0 c2"><span></span></p><p class="c0"><span>I have used JetBrains PyCharm in the past. &nbsp;I think this is a pretty good environment if you are not home row oriented. &nbsp;I gave up on it a few years ago because of its mouse orientation getting in the way of writing code and its speed. &nbsp;I&rsquo;ve heard its performance has been significantly enhanced since. &nbsp;There is a community and commercial version of this package so you can try out its basic functionality inexpensively.</span></p><p class="c0 c2"><span></span></p><p class="c0"><span>For doing interactive analysis people should look at IPython. &nbsp;This is an awesome environment built around applying code cells to data and producing visuals in a notebook style of development. &nbsp;This was built by a Physicist originally at CU Boulder and later at Berkeley. &nbsp;It has many features which fit together in a really holistic manner. &nbsp;Combined with numpy, scipy, and pandas this is the core for a nice python analysis environment.</span></p><h1 class="c0 c1"><a name="h.jn7qh7kh8apj"></a><span>Other Resources</span></h1><p class="c0"><span>The way you learn how to program in any language is to read source written by people who are good at it. &nbsp;For example nobody learns c well without reading unix kernel source. &nbsp;In the case of Python reading the standard library source is a good way to learn.</span></p></body></html>